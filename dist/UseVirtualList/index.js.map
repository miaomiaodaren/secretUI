{"version":3,"sources":["UseVirtualList/index.tsx"],"names":["prefixCls","UseVirtualList","list","options","containerRef","size","target","current","start","end","state","setState","itemHeight","overscan","getViewCapacity","containerHeight","Math","ceil","sum","capacity","i","length","height","getOffset","scrollTop","floor","offset","calculateRange","element","viewCapacity","clientHeight","from","to","width","totalHeight","reduce","_","index","getDistanceTop","slice","scrollTo","offsetTop","map","ele","data","containerProps","ref","onScroll","e","preventDefault","style","overflowY","wrapperProps","marginTop"],"mappings":"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","sourcesContent":["import type React from 'react';\nimport type { MutableRefObject } from 'react';\nimport { useState, useRef, useEffect, useMemo } from 'react';\nimport useSize from '../useSize';\n\nconst prefixCls = 'UseVirtualList';\n\ninterface IProps<T = any> {\n  list: T[];\n  options: {\n    itemHeight: number | ((index: number) => number);\n    overscan?: number;\n  };\n}\n\nconst UseVirtualList = (list: IProps['list'], options: IProps['options']) => {\n  const containerRef = useRef<HTMLElement | null>();\n  const size = useSize({ target: containerRef.current as HTMLElement });\n  const [state, setState] = useState({ start: 0, end: 10 });\n  const { itemHeight, overscan = 5 } = options;\n  const getViewCapacity = (containerHeight: number) => {\n    if (typeof itemHeight === 'number') {\n      return Math.ceil(containerHeight / itemHeight);\n    }\n    const { start = 0 } = state;\n    let sum = 0;\n    let capacity = 0;\n    // eslint-disable-next-line no-plusplus\n    for (let i = start; i < list.length; i++) {\n      const height = (itemHeight as (index: number) => number)(i);\n      sum += height;\n      if (sum >= containerHeight) {\n        capacity = i;\n        break;\n      }\n    }\n    return capacity - start;\n  };\n  const getOffset = (scrollTop: number) => {\n    if (typeof itemHeight === 'number') {\n      return Math.floor(scrollTop / itemHeight) + 1;\n    }\n    let sum = 0;\n    let offset = 0;\n    // eslint-disable-next-line no-plusplus\n    for (let i = 0; i < list.length; i++) {\n      const height = (itemHeight as (index: number) => number)(i);\n      sum += height;\n      if (sum >= scrollTop) {\n        offset = i;\n        break;\n      }\n    }\n    return offset + 1;\n  };\n  const calculateRange = () => {\n    const element = containerRef.current;\n    if (element) {\n      const offset = getOffset(element.scrollTop);\n      const viewCapacity = getViewCapacity(element.clientHeight);\n      const from = offset - overscan;\n      const to = offset + viewCapacity + overscan;\n      setState({\n        start: from < 0 ? 0 : from,\n        end: to > list.length ? list.length : to,\n      });\n    }\n  };\n  useEffect(() => {\n    calculateRange();\n  }, [size.width, size.height, list.length]);\n  const totalHeight = useMemo(() => {\n    if (typeof itemHeight === 'number') {\n      return list.length * itemHeight;\n    }\n    return list.reduce((sum, _, index) => sum + itemHeight(index), 0);\n  }, [list.length]);\n  const getDistanceTop = (index: number) => {\n    // 如果有缓存，优先返回缓存值\n    // if (enableCache && distanceCache.current[index]) {\n    //   return distanceCache.current[index];\n    // }\n    if (typeof itemHeight === 'number') {\n      const height = index * itemHeight;\n      // if (enableCache) {\n      //   distanceCache.current[index] = height;\n      // }\n      return height;\n    }\n    const height = list.slice(0, index).reduce((sum, _, i) => sum + itemHeight(i), 0);\n    // if (enableCache) {\n    //   distanceCache.current[index] = height;\n    // }\n    return height;\n  };\n\n  const scrollTo = (index: number) => {\n    if (containerRef.current) {\n      containerRef.current.scrollTop = getDistanceTop(index);\n      calculateRange();\n    }\n  };\n\n  const offsetTop = useMemo(() => getDistanceTop(state.start), [state.start]);\n  return {\n    list: list\n      .slice(state.start, state.end)\n      .map((ele, index) => ({ data: ele, index: index + state.start })),\n    containerProps: {\n      ref: (ele: any) => {\n        containerRef.current = ele;\n      },\n      onScroll: (e: React.ChangeEvent<HTMLInputElement>) => {\n        e.preventDefault();\n        calculateRange();\n      },\n      style: { overflowY: 'auto' },\n    },\n    scrollTo,\n    wrapperProps: {\n      style: {\n        width: '100%',\n        height: totalHeight - offsetTop,\n        marginTop: offsetTop,\n      },\n    },\n  };\n};\n\nexport default UseVirtualList;\n"],"file":"index.js"}